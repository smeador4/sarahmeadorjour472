---
title: "Reverse Engineering Project"
author: "Sarah Meador"
date: "3/7/24"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

In this notebook, we are reverse engineering the story, [Thousands of kids are missing from school. Where did they go?](https://projects.apnews.com/features/2023/missing-children/index.html)

## Load libraries

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}

library(tidyverse)
library(janitor)
library(lubridate)

pop_age <- read_csv("data/population-by-age.csv")|>
  clean_names() 
public_enrollment <- read_csv("data/public-enrollment-by-grade.csv")|>
  clean_names() 
private_enrollment <- read_csv("data/private-enrollment-by-grade.csv")|>
  clean_names()

## Load and Cleaning Data

#In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

# Load required data

# Path to data should be loaded from folder "data" i.e. read_csv("data/name_of_data.csv")

# Clean required data and prepare for analysis if needed. 


```

## Sentences to Engineer

In this notebook, we are reverse engineering five sentences from the story.

### Sentence 1

-   **Sentence text**: "Public school enrollment plunged during the pandemic. Our analysis shows where the students went. In the 21 states where data was available, enrollment fell by about 700,000 students between the 2019-2020 and 2021-2022 school years."
-   **Analysis summary**: We got different results because our analysis included more than 21 states. This sentence in the story does not specify the 21 states where enrollment drops totaled about 700k. We'd need to find out how to filter the states and enrollments for the years.

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock
public_enrollment |>
  filter(enrollment >= 0)|>
  group_by(sch_year) |>
  summarize(pub_enrollment = sum(enrollment)) |>
  summarize(enrollment_change = ((max(pub_enrollment)) - (min(pub_enrollment))))
  
```

### Sentence 2

-   **Sentence text**: "California alone showed over 150,000 missing students in the data, and New York had nearly 60,000."
-   **Analysis summary**: In my analysis, I came to the conclusion that in my updated version of the data, California shows 541,856 missing students from the 2019-2020 school year to the 2021-2022 school year. New York shows 264,796 missing students from these school years in the updated data.

```{r}
# Put code to reverse engineer sentence here
public_enrollment |>
  filter(state == 'CALIFORNIA') |>
  group_by(sch_year) |>
    summarize(total_enrollment = sum(enrollment)) |>
  summarize(enrollment_change = ((max(total_enrollment)) - (min(total_enrollment))))

# Display results of code below this codeblock

```

```{r}
public_enrollment |>
  filter(state == 'NEW YORK') |>
  group_by(sch_year) |>
    summarize(total_enrollment = sum(enrollment)) |>
  summarize(enrollment_change = ((max(total_enrollment)) - (min(total_enrollment))))
```

### Sentence 3

-   **Sentence text**: "That leaves an unexpected 230,000 students still unaccounted for in the data."
-   **Analysis summary**: The population by age summarization shows that there were about 12 million fewer kids enrolled than what should have been. The issue with this is it does not necessarily support the above statement from AP's investigation but we can not be entirely sure because the datasets did not provide us with the number of children who were being homeschooled. It's likely that this would slim down the data for us to best reflect how many students are missing.

```{r}
# Put code to reverse engineer sentence here
private_enrollment <- private_enrollment|>
  rename(st = state)

enrollment_totals <- public_enrollment |>
  # join md10 to md21 using the shared GEOID and NAME columns
  inner_join(private_enrollment, by=c('st', 'grade', 'sch_year'))|>
mutate(total_enrollment = enrollment.x + enrollment.y)

enrollment_totals |>
  filter(str_detect(grade, "total"))|>
  group_by(sch_year)|>
  summarise(enrollment = sum(total_enrollment)) |>
  arrange(desc(sch_year))

pop_age |>
  group_by(est_date) |>
  summarize(school_age_pop = sum(population))

# Display results of code below this codeblock

```

### Sentence 4

-   **Sentence text**: "Across the states in the analysis, private-school enrollment grew by about 103,000 students."
-   **Analysis summary**: This shows an additional 40,707 students had enrolled in private school from 2019-2020 to 2021-2022 than AP reported in their investigation. This is likely because additional data was found after publishing.

```{r}
# Put code to reverse engineer sentence here
private_enrollment |>
filter(enrollment >= 0 & str_detect(grade, "_total"))|>
  group_by(sch_year) |>
  summarize(total_enrollment = sum(enrollment))|>

#subtract the years of enrollment

summarise(year_by_year_change = 3674490 - 3530783)
  
  

# Display results of code below this codeblock

```

### Sentence 5

-   **Sentence text**: "The population of school-age kids in the states we studied fell by about 183,000, according to census estimates."
-   **Analysis summary**: This code shows a decrease in population of school-age kids in the states by 253,566 from April of 2020 to July of 2021, which is higher than AP's calculation because we now have more updated data.

```{r}
# Put code to reverse engineer sentence here
pop_age |>
  group_by(est_date) |>
  summarize(sum = sum(population)) |>
  summarize(population_change = ((max(sum)) - (min(sum))))
# Display results of code below this codeblock

```

-30-
